---
name: cisco-ise
namespace: com.citrix.adc.stylebooks
version: "1.0"
display-name: "Cisco ISE"
description: "This stylebook deploys an LB VServer on Citrix ADC with recommended best practices"
schema-version: "1.0"
import-stylebooks: 
  -
    namespace: netscaler.nitro.config
    prefix: ns
    version: "11.1"
  -
    namespace: com.citrix.adc.commontypes
    prefix: cmtypes
    version: "1.0"
  -
    namespace: com.citrix.adc.stylebooks
    prefix: stlb
    version: "1.0"
parameters:
  -
    name: ise-radius-sb
    label: Cisco ISE Radius LB
    description: |
     <img src="https://kxiwq67737.i.lithium.com/t5/image/serverpage/image-id/16436i800E8A9DE994DF5E/image-size/large?v=1.0&px=999"><h1> Cisco Identity Services Engine (ISE)</h1>This StyleBook creates the required entities for Load Balancing Cisco ISE Radius servers in accord with best practices</br>
     fields with an * are required
    type: object
    required: true
    parameters:
     - 
       name: appname
       label: ISE Applicaiton Name
       description: Prefix for created entities
       type: string
       key: true
       gui:
        updatable: true
       required: true
  - 
    name: ise-radius-auth
    label: ISE Radius Authentication Server(s)
    description: |
     Creates an LB Vserver object for Load Balancing ISE Radius Authentication Servers with recommended settings and persistence
    type: object
    required: true
    parameters:
     - 
       name: auth-lbvserver-ip
       label: Public IP
       description: "ISE Auth Public IP"
       type: ipaddress
       required: true
     -  
       name: auth-lbvserver-port
       label: Public Port
       description: ISE Radius Authentication Public IP
       type: number
       default: 1812
       required: true
     - 
       name: auth-servers
       label: Radius Auth Server(s)
       description: ISE Radius Authentication Server(s)
       type: cmtypes::server-ip-port-radius-auth-params[]
       required: true
  - 
    name: ise-radius-acct
    label: ISE Radius Accounting (Click to Enable)
    description: |
     Creates an LB Vserver object for Load Balancing ISE Radius Accounting Servers with recommended settings and persistence
    type: object
    parameters:
     - 
       name: acct-lbvserver-ip
       label: "Public IP"
       description: ISE Acct Public IP
       type: ipaddress
       required: true
     - 
       name: acct-lbvserver-port
       label: Public Port
       description: ISE Radius Acconting Public Port
       type: number
       default: 1813
       required: true    
     -
       name: acct-servers
       label: Radius Acct Server(s)
       description: ISE Radius Accounting Server(s)
       type: cmtypes::server-ip-port-radius-acct-params[]
       required: true
components:
  - 
    name: ise-auth-lbvserver-comp
    type: ns::lbvserver
    properties: 
      name: str("lbv_radius_auth_") + $parameters.ise-radius-sb.appname
      servicetype: RADIUS
      ipv46: $parameters.ise-radius-auth.auth-lbvserver-ip
      port: $parameters.ise-radius-auth.auth-lbvserver-port
      lbmethod: LEASTCONNECTION
      persistencetype: RULE
      rule: str("CLIENT.UDP.RADIUS.ATTR_TYPE") + "(" + "8" + ")" + "+" + str("CLIENT.UDP.RADIUS.ATTR_TYPE") + "(" + "31" + ")"
    components: 
      - 
        name: auth-servicegroup-comp
        type: ns::servicegroup
        properties: 
          servicegroupname: str("svcg_radius_auth_") + $parameters.ise-radius-sb.appname
          servicetype: RADIUS
          usip: "YES"
          useproxyport: "YES"
          clttimeout: 120
          svrtimeout: 120
        components: 
          - 
            name: auth-lbvserver-svcg-binding
            type: ns::lbvserver_servicegroup_binding
            properties: 
              name: $parent.parent.properties.name
              servicegroupname: $parent.properties.servicegroupname
          -
            name: auth-server-members
            type: ns::server 
            repeat: $parameters.ise-radius-auth.auth-servers
            repeat-item: server
            repeat-condition: $server.add-server
            properties:
              name: str($server.ip)
              ipaddress: $server.ip
          - 
            name: auth-svcg-ip-members
            type: ns::servicegroup_servicegroupmember_binding
            repeat: $parameters.ise-radius-auth.auth-servers
            repeat-item: server
            properties: 
              servicegroupname: $parent.properties.servicegroupname
              ip: $server.ip
              port: $server.port
  - 
    name: ise-acct-lbvserver-comp
    type: ns::lbvserver
    condition: $parameters.ise-radius-acct
    properties: 
      name: str("lbv_radius_acct_") + $parameters.ise-radius-sb.appname
      servicetype: RADIUS
      ipv46: $parameters.ise-radius-acct.acct-lbvserver-ip
      port: $parameters.ise-radius-acct.acct-lbvserver-port
      lbmethod: LEASTCONNECTION
      persistencetype: RULE
      rule:  str("CLIENT.UDP.RADIUS.ATTR_TYPE") + "(" + "8" + ")" + "+" + str("CLIENT.UDP.RADIUS.ATTR_TYPE") + "(" + "31" + ")"
    components: 
      - 
        name: acct-servicegroup-comp
        type: ns::servicegroup 
        properties: 
          servicegroupname: str("svcg_radius_acct_") + $parameters.ise-radius-sb.appname
          servicetype: RADIUS
          usip: "YES"
          useproxyport: "YES"
          clttimeout: 120
          svrtimeout: 120
        components: 
          - 
           name: acct-lbvserver-svcg-binding
           type: ns::lbvserver_servicegroup_binding
           properties: 
             name: $parent.parent.properties.name
             servicegroupname: $parent.properties.servicegroupname
          -
           name: acct-server-members
           type: ns::server 
           repeat: $parameters.ise-radius-acct.acct-servers
           repeat-item: server
           repeat-condition: $server.add-server
           properties:
             name: str($server.ip)
             ipaddress: $server.ip
          - 
           name: acct-svcg-ip-members
           type: ns::servicegroup_servicegroupmember_binding
           repeat: $parameters.ise-radius-acct.acct-servers
           repeat-item: server
           properties: 
             servicegroupname: $parent.properties.servicegroupname
             ip: $server.ip
             port: $server.port
outputs:
  -
    name: ise-auth-lbvserver-comp
    value: $components.ise-auth-lbvserver-comp
  -
    name: ise-acct-lbvserver-comp
    value: $components.ise-acct-lbvserver-comp
